# DAREG Default Configuration
# MIRTK-equivalent registration parameters
# Reference: regTemplate_mirtk/REGTOOL/register.cfg

# Input/Output settings
io:
  source_image: null  # Must be specified
  target_image: null  # Must be specified
  segmentation: null  # Optional segmentation to transform
  output_dir: ./dareg_outputs

# Registration pipeline settings
pipeline:
  stages: ["rigid", "affine", "ffd"]  # Options: rigid, affine, ffd, svffd
  device: auto  # auto, cpu, cuda, mps

# Similarity measure (MIRTK default: NMI)
similarity:
  metric: nmi  # nmi, ncc, ssd
  num_bins: 64  # Histogram bins for NMI
  foreground_threshold: 0.01  # FG_Overlap threshold (MIRTK default)

# Rigid registration parameters
rigid:
  pyramid_levels: 4
  iterations_per_level: [100, 100, 100, 100]
  learning_rates_per_level: [0.01, 0.01, 0.01, 0.01]
  convergence:
    min_delta: 0.000001
    patience: 20

# Affine registration parameters
affine:
  pyramid_levels: 4
  iterations_per_level: [100, 100, 100, 100]
  learning_rates_per_level: [0.005, 0.005, 0.005, 0.005]
  convergence:
    min_delta: 0.000001
    patience: 20

# FFD registration parameters (MIRTK-equivalent)
ffd:
  model: ffd  # ffd or svffd (diffeomorphic)
  control_point_spacing: 4  # mm (MIRTK -ds parameter)
  pyramid_levels: 4
  iterations_per_level: [100, 100, 100, 100]
  learning_rates_per_level: [0.01, 0.01, 0.01, 0.01]
  # Regularization (MIRTK: BE=0.001, LE=0.0005)
  regularization:
    bending_weight: 0.001  # Bending energy weight
    diffusion_weight: 0.0005  # Linear/diffusion energy weight
  # SVFFD-specific
  svffd:
    integration_steps: 5  # Scaling-squaring steps
    world_coord_regularization: true  # Fix for anisotropic images
  convergence:
    min_delta: 0.000001
    patience: 20

# Output settings
output:
  save_intermediate: true  # Save after each stage
  save_transforms: true  # Save transform files (.pth)
  create_visualizations: true  # Create PNG visualizations
  create_pdf_report: true  # Create comprehensive PDF report

# Visualization settings
visualization:
  dpi: 150
  figsize: [18, 12]
  colormap: gray
